<!DOCTYPE html><html><title>JSame4k</title><style type="text/css">body{background-color:#fff;margin:0}#js4kwrapper{display:table;position:absolute;height:100%;width:100%}#js4kcontainer{display:table-cell;vertical-align:middle}#jsame4k{display:block;height:418px;margin:0 auto;width:528px}</style><div id="js4kwrapper"><div id="js4kcontainer"><canvas id="jsame4k" width="528" height="418"></canvas></div></div><script>!function(){function t(t){var o=m.getBoundingClientRect();return{x:m.width/o.width*(t.clientX-o.left),y:m.height/o.height*(t.clientY-o.top)}}function o(t){for(var o=1;o<arguments.length;o++)t=t.replace(/%s/,arguments[o]);return t}function e(t){return[t>>16,t>>8&255,255&t]}function n(t){return t=(t[0]<<16|t[1]<<8|t[2]).toString(16),"#"+(Array(7-t.length).join("0")+t)}function r(t){var o=t[0],e=t[1];t=t[2];var n=~~(1/(1-j));return 0==o&&0==e&&0==t?[n,n,n]:(o>0&&n>o&&(o=n),e>0&&n>e&&(e=n),t>0&&n>t&&(t=n),[Math.min(~~(o/j),255),Math.min(~~(e/j),255),Math.min(~~(t/j),255)])}function f(){M=Array(2*G.length-1);for(var t=0;t<G.length;t++)M[t]=l(e(G[t]),!0),M[2*G.length-2-t]=l(e(G[t]),!1)}function l(t,o){var e=document.createElement("canvas");e.width=b,e.height=b;var f=e.getContext("2d"),l=o?r(t):t,a=r(l),i=[~~(l[0]*j),~~(l[1]*j),~~(l[2]*j)];f.fillStyle=n(i),f.fillRect(0,0,b,b),f.fillStyle=n(l),f.fillRect(0,0,b-1,b-1),f.fillStyle=n(a),f.fillRect(1,1,b-3,b-3);var h=f.createLinearGradient(2,2,b-4,b-4);return h.addColorStop(0,n(l)),h.addColorStop(1,n(a)),f.fillStyle=h,f.fillRect(2,2,b-4,b-4),o&&(f.fillStyle=n(i),f.fillRect(8,8,b-16,b-16)),e}function a(){x.fillStyle="#262c4b",x.fillRect(0,0,C*b+2*A,L*b+2*A),x.fillStyle="#484d50",x.fillRect(0,L*b+2*A,C*b+2*A,k),x.font="bold 12px sans-serif",s[1]=w>1?o("Marked: %s (%s points)",w,w*w-4*w+4):S?"":"Game Over!",s[2]=o("Score: %s",p);for(var t=0;t<s.length;t++)x.fillStyle="#62696a",x.fillRect(~~((C*b+2*A)/3)*t+1,L*b+2*A+1,~~((C*b+2*A)/3)-2,k-2),x.fillStyle="#ffffff",x.fillText(s[t],~~((C*b+2*A)/6)*(2*t+1)-~~(x.measureText(s[t]).width/2),L*b+2*A+~~(k/2)+4);for(t=0;C>t;t++)for(var e=0;L>e;e++)x.drawImage(M[g[C*e+t]+B],t*b+A,e*b+A)}function i(){p=w=0,E=!1,S=!0;for(var t=0;t<g.length;t++)g[t]=~~(Math.random()*B+1)}function h(t,o){return 0>t||0>o||t>C-1||o>L-1?0:g[C*o+t]}function u(t,o){return 0>h(t,o)?-1*h(t,o):h(t,o)}function c(t,o,e){return 0>h(t,o)||e!=u(t,o)||0==h(t,o)?0:(e=1,g[C*o+t]=-1*u(t,o),e+=c(t-1,o,u(t,o)),e+=c(t,o-1,u(t,o)),e+=c(t+1,o,u(t,o)),e+c(t,o+1,u(t,o)))}function d(){for(var t=0;t<g.length;t++)g[t]=0>g[t]?-1*g[t]:g[t]}function y(t,o,e,n){t=C*o+t,e=C*n+e,n=g[t],g[t]=g[e],g[e]=n}function v(o,e){var n=t(o),r=n.x<A?-1:~~((n.x-A)/b),n=n.y<A?-1:~~((n.y-A)/b);(!(R.x==r&&R.y==n||0>h(r,n))||e)&&((0!=h(r,n)||0!=h(R.x,R.y))&&(d(),w=c(r,n,u(r,n)),a()),R.x=r,R.y=n)}var M,g,s,m,x,S,R,p,w,E,C=20,L=15,b=26,k=20,A=4,G=[9522747,8094582,4022919,11503186,2501707],j=.7,B=G.length-1;!function(){m=document.getElementById("jsame4k"),null!=m&&m.getContext&&(x=m.getContext("2d"),f(),g=Array(C*L),R={x:-1,y:-1},s=["New Game","",""],i(),a(),m.addEventListener("mousedown",function(o){var e,n,r,f=t(o);0<f.x&&f.x<~~((C*b+2*A)/3)-1&&f.y>L*b+2*A&&f.y<L*b+2*A+k-1&&(i(),S=!0,w=0,a());var l=f.x<A?-1:~~((f.x-A)/b),d=f.y<A?-1:~~((f.y-A)/b);for(n=e=0;n<g.length;n++)0>g[n]&&e++;if(e>=2){for(n=0;n<g.length;n++)0>g[n]&&(g[n]=0);for(r=0;C>r;r++)for(o=!0;o;)for(o=!1,f=1;L>f;f++)0==h(r,f)&&0!=h(r,f-1)&&(y(r,f,r,f-1),o=!0);for(o=!0;o;)for(o=!1,r=1;C>r;r++)if(0==h(r-1,L-1)&&0!=h(r,L-1)){for(f=0;L>f;f++)y(r,f,r-1,f);o=!0}for(p+=e*e-4*e+4,o=!0,n=e=0;C>n;n++)for(r=0;L>r;r++)if(0!=h(n,r)&&(e++,f=u(n,r),u(n-1,r)==f||u(n,r-1)==f||u(n+1,r)==f||u(n,r+1)==f)){o=!1;break}0!=e||E||(E=!0,p+=1e3),w=0,o||(w=c(l,d,u(l,d))),o&&S&&(S=!1,w=0),a()}},!1),m.addEventListener("mouseup",function(t){v(t,!0)},!1),m.addEventListener("mousemove",function(t){v(t,!1)},!1),m.addEventListener("mouseover",function(t){v(t,!1)},!1),m.addEventListener("mouseout",function(o){var e=t(o);o=e.x<A?-1:~~((e.x-A)/b),e=e.y<A?-1:~~((e.y-A)/b),d(),w=0,a(),R.x=o,R.y=e},!1))}()}();</script></html>