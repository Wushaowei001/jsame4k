(function(){function w(a){for(var b=1;b<arguments.length;b++)a=a.replace(/%s/,arguments[b]);return a}function x(a){return[a>>16,a>>8&255,a&255]}function m(a){a=(a[0]<<16|a[1]<<8|a[2]).toString(16);return"#"+(Array(7-a.length).join("0")+a)}function y(a){var b=a[0],d=a[1];a=a[2];var c=Math.floor(1/(1-.7));if(0==b&&0==d&&0==a)return[c,c,c];0<b&&b<c&&(b=c);0<d&&d<c&&(d=c);0<a&&a<c&&(a=c);return[Math.min(Math.floor(b/.7),255),Math.min(Math.floor(d/.7),255),Math.min(Math.floor(a/.7),255)]}function E(){t=
Array(2*n.length-1);for(var a=0;a<n.length;a++)t[a]=z(x(n[a]),!0),t[2*n.length-2-a]=z(x(n[a]),!1)}function z(a,b){var d=document.createElement("canvas");d.width=26;d.height=26;var c=d.getContext("2d"),e=b?y(a):a,f=y(e),h=[Math.floor(.7*e[0]),Math.floor(.7*e[1]),Math.floor(.7*e[2])];c.fillStyle=m(h);c.fillRect(0,0,26,26);c.fillStyle=m(e);c.fillRect(0,0,25,25);c.fillStyle=m(f);c.fillRect(1,1,23,23);var g=c.createLinearGradient(2,2,22,22);g.addColorStop(0,m(e));g.addColorStop(1,m(f));c.fillStyle=g;c.fillRect(2,
2,22,22);b&&(c.fillStyle=m(h),c.fillRect(8,8,10,10));return d}function A(){f.fillStyle="#262c4b";f.fillRect(0,0,528,398);f.fillStyle="#484d50";f.fillRect(0,398,528,20);f.font="bold 12px sans-serif";p[1]=1<k?w("Marked: %s (%s points)",k,k*k-4*k+4):q?"":"Game Over!";p[2]=w("Score: %s",u);for(var a=0;a<p.length;a++)f.fillStyle="#62696a",f.fillRect(Math.floor(176)*a+1,399,Math.floor(176)-2,18),f.fillStyle="#ffffff",f.fillText(p[a],Math.floor(88)*(2*a+1)-Math.floor(f.measureText(p[a]).width/2),398+Math.floor(10)+
4);for(a=0;20>a;a++)for(var b=0;15>b;b++)f.drawImage(t[e[20*b+a]+B],26*a+4,26*b+4)}function C(){u=k=0;v=!1;q=!0;for(var a=0;a<e.length;a++)e[a]=Math.floor(Math.random()*B+1)}function h(a,b){return 0>a||0>b||19<a||14<b?0:e[20*b+a]}function g(a,b){return 0>h(a,b)?-1*h(a,b):h(a,b)}function r(a,b,d){if(0>h(a,b)||d!=g(a,b)||0==h(a,b))return 0;e[20*b+a]=-1*g(a,b);d=1+r(a-1,b,g(a,b));d+=r(a,b-1,g(a,b));d+=r(a+1,b,g(a,b));return d+=r(a,b+1,g(a,b))}function D(a,b,d,c){a=20*b+a;d=20*c+d;c=e[a];e[a]=e[d];e[d]=
c}function F(a){var b,d,c;c=l.getBoundingClientRect();b=l.width/c.width*(a.touches[0].clientX-c.left);a=l.height/c.height*(a.touches[0].clientY-c.top);if(0<b&&b<Math.floor(176)-1&&398<a&&417>a)C(),q=!0,k=0;else if(b=4>b?-1:Math.floor((b-4)/26),a=4>a?-1:Math.floor((a-4)/26),0>h(b,a)){for(d=a=0;d<e.length;d++)0>e[d]&&a++;if(2>a)return;for(d=0;d<e.length;d++)0>e[d]&&(e[d]=0);for(c=0;20>c;c++)for(b=!0;b;)for(b=!1,d=1;15>d;d++)0==h(c,d)&&0!=h(c,d-1)&&(D(c,d,c,d-1),b=!0);for(b=!0;b;)for(b=!1,c=1;20>c;c++)if(0==
h(c-1,14)&&0!=h(c,14)){for(d=0;15>d;d++)D(c,d,c-1,d);b=!0}u+=a*a-4*a+4;b=!0;for(d=a=0;20>d;d++)for(c=0;15>c;c++)if(0!=h(d,c)){a++;var f=g(d,c);if(g(d-1,c)==f||g(d,c-1)==f||g(d+1,c)==f||g(d,c+1)==f){b=!1;break}}0!=a||v||(v=!0,u+=1E3);k=0;b&&q&&(q=!1)}else if(0!=h(b,a)){for(c=0;c<e.length;c++)e[c]=0>e[c]?-1*e[c]:e[c];k=r(b,a,g(b,a))}A()}var n=[9522747,8094582,4022919,11503186,2501707],B=n.length-1,t,e,p,l,f,q,u,k,v;l=document.getElementById("jsame4k");null!=l&&l.getContext?(f=l.getContext("2d"),E(),
e=Array(300),p=["New Game","",""],C(),A(),l.addEventListener("touchstart",F,!1)):document.body.appendChild(document.createTextNode("Could not initialize game."))})();
